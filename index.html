<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>APULA FIRE COMMAND - Emergency Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800;900&family=Orbitron:wght@400;500;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* === FIRE EMERGENCY THEME === */
        :root {
            /* Emergency Color Palette */
            --emergency-red: #FF2200;
            --fire-orange: #FF5500;
            --hazard-yellow: #FFAA00;
            --rescue-orange: #FF6B35;
            --water-blue: #00A8FF;
            --command-blue: #0077FF;
            --thermal-purple: #9D00FF;
            --hazmat-green: #00FF88;
            --night-black: #0A0A0F;
            --carbon-grey: #1A1A25;
            --steel-grey: #2A2A35;
            --aluminum: #E0E0E8;
            
            /* Alert Levels */
            --alert-critical: #FF2200;
            --alert-high: #FF5500;
            --alert-medium: #FFAA00;
            --alert-low: #00A8FF;
            --alert-normal: #00FF88;
            
            /* Emergency Gradients */
            --bg-gradient: linear-gradient(135deg, #0A0A0F 0%, #1A0A15 30%, #0A0A1A 70%, #0A151A 100%);
            --card-gradient: linear-gradient(165deg, rgba(26, 26, 37, 0.95) 0%, rgba(42, 26, 37, 0.9) 100%);
            --header-gradient: linear-gradient(90deg, 
                rgba(255, 34, 0, 0.9) 0%, 
                rgba(255, 85, 0, 0.9) 25%, 
                rgba(255, 170, 0, 0.8) 50%, 
                rgba(255, 107, 53, 0.9) 75%, 
                rgba(255, 34, 0, 0.9) 100%);
            
            /* Emergency Effects */
            --glow-critical: 0 0 30px rgba(255, 34, 0, 0.7);
            --glow-warning: 0 0 25px rgba(255, 170, 0, 0.6);
            --glow-safe: 0 0 20px rgba(0, 255, 136, 0.5);
            --glow-water: 0 0 20px rgba(0, 168, 255, 0.6);
            --shadow-deep: 0 10px 30px rgba(0, 0, 0, 0.7);
            
            /* Tactical Elements */
            --border-tactical: 2px solid rgba(255, 85, 0, 0.3);
            --border-alert: 2px solid rgba(255, 34, 0, 0.6);
            --border-safe: 2px solid rgba(0, 255, 136, 0.4);
            --border-radius-tactical: 12px;
            --border-radius-critical: 8px;
            
            /* Spacing */
            --spacing-tight: 8px;
            --spacing-base: 12px;
            --spacing-wide: 16px;
            --spacing-xwide: 24px;
            --spacing-ultra: 32px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: var(--bg-gradient);
            color: var(--aluminum);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
            font-family: 'Montserrat', sans-serif;
            font-size: 14px;
            line-height: 1.6;
        }

        /* Emergency Background Pattern */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 15% 25%, rgba(255, 34, 0, 0.03) 0%, transparent 40%),
                radial-gradient(circle at 85% 75%, rgba(0, 168, 255, 0.03) 0%, transparent 40%),
                linear-gradient(45deg, transparent 48%, rgba(255, 85, 0, 0.02) 50%, transparent 52%),
                linear-gradient(-45deg, transparent 48%, rgba(255, 170, 0, 0.02) 50%, transparent 52%);
            background-size: 100% 100%, 100% 100%, 40px 40px, 40px 40px;
            pointer-events: none;
            z-index: -2;
        }

        /* Emergency Grid Overlay */
        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(rgba(255, 85, 0, 0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 85, 0, 0.05) 1px, transparent 1px);
            background-size: 40px 40px;
            pointer-events: none;
            z-index: -1;
        }

        /* Custom Scrollbar - Emergency Theme */
        ::-webkit-scrollbar {
            width: 10px;
            background: var(--carbon-grey);
        }

        ::-webkit-scrollbar-track {
            background: rgba(26, 26, 37, 0.8);
            border-radius: 4px;
            border: 1px solid rgba(255, 85, 0, 0.2);
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, var(--fire-orange), var(--emergency-red));
            border-radius: 4px;
            border: 2px solid rgba(26, 26, 37, 0.8);
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(180deg, var(--emergency-red), var(--fire-orange));
            box-shadow: var(--glow-critical);
        }

        /* === EMERGENCY HEADER === */
        .emergency-header {
            background: var(--header-gradient);
            padding: var(--spacing-wide);
            margin-bottom: var(--spacing-xwide);
            position: relative;
            overflow: hidden;
            border-bottom: 3px solid var(--emergency-red);
            box-shadow: var(--glow-critical), var(--shadow-deep);
        }

        .emergency-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(255, 255, 255, 0.1), 
                transparent);
            animation: emergencyScan 3s linear infinite;
        }

        @keyframes emergencyScan {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            z-index: 1;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: var(--spacing-wide);
        }

        .emergency-logo {
            font-family: 'Orbitron', sans-serif;
            font-size: 2.8rem;
            font-weight: 900;
            color: white;
            text-shadow: 
                0 0 15px rgba(255, 34, 0, 0.8),
                0 0 30px rgba(255, 34, 0, 0.5),
                2px 2px 4px rgba(0, 0, 0, 0.8);
            letter-spacing: 3px;
            background: linear-gradient(45deg, #FFFFFF, #FFD700, #FFFFFF);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            position: relative;
        }

        .emergency-logo::after {
            content: 'FIRE COMMAND';
            position: absolute;
            top: 100%;
            left: 0;
            font-size: 0.8rem;
            font-family: 'Montserrat', sans-serif;
            font-weight: 700;
            letter-spacing: 2px;
            color: var(--hazard-yellow);
            text-shadow: 0 0 10px rgba(255, 170, 0, 0.7);
        }

        .emergency-icon {
            font-size: 3.5rem;
            color: white;
            filter: drop-shadow(0 0 15px rgba(255, 34, 0, 0.8));
            animation: iconPulse 2s ease-in-out infinite;
        }

        @keyframes iconPulse {
            0%, 100% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.1) rotate(5deg); }
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: var(--spacing-wide);
            background: rgba(26, 26, 37, 0.8);
            padding: var(--spacing-base);
            border-radius: var(--border-radius-tactical);
            border: var(--border-tactical);
            backdrop-filter: blur(10px);
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-dot.critical {
            background: var(--alert-critical);
            box-shadow: var(--glow-critical);
            animation: pulseCritical 1s infinite;
        }

        @keyframes pulseCritical {
            0%, 100% { 
                box-shadow: 0 0 0 0 rgba(255, 34, 0, 0.7),
                            var(--glow-critical);
            }
            70% { 
                box-shadow: 0 0 0 10px rgba(255, 34, 0, 0),
                            var(--glow-critical);
            }
        }

        .status-dot.warning { background: var(--alert-high); }
        .status-dot.safe { background: var(--alert-normal); }

        /* === TACTICAL DASHBOARD GRID === */
        .tactical-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: var(--spacing-xwide);
            padding: var(--spacing-wide);
            max-width: 1800px;
            margin: 0 auto;
        }

        /* EMERGENCY STATUS PANEL */
        .status-panel {
            background: var(--card-gradient);
            border-radius: var(--border-radius-tactical);
            padding: var(--spacing-xwide);
            border: var(--border-tactical);
            box-shadow: var(--shadow-deep);
            position: relative;
            overflow: hidden;
        }

        .status-panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, 
                var(--emergency-red),
                var(--fire-orange),
                var(--hazard-yellow));
        }

        .panel-header {
            display: flex;
            align-items: center;
            gap: var(--spacing-base);
            margin-bottom: var(--spacing-xwide);
            padding-bottom: var(--spacing-base);
            border-bottom: 1px solid rgba(255, 85, 0, 0.3);
        }

        .panel-icon {
            font-size: 1.8rem;
            color: var(--fire-orange);
            background: rgba(255, 85, 0, 0.1);
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            border: 1px solid rgba(255, 85, 0, 0.3);
        }

        .panel-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--aluminum);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* STATUS GRID */
        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: var(--spacing-base);
        }

        .status-tile {
            background: rgba(42, 42, 53, 0.8);
            border-radius: var(--border-radius-critical);
            padding: var(--spacing-wide);
            border: 2px solid transparent;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            cursor: pointer;
            min-height: 140px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .status-tile:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-deep);
        }

        .status-tile.critical {
            border-color: var(--alert-critical);
            background: linear-gradient(135deg, 
                rgba(58, 10, 10, 0.9),
                rgba(42, 10, 10, 0.9));
            animation: alertCritical 2s infinite;
        }

        @keyframes alertCritical {
            0%, 100% { 
                box-shadow: inset 0 0 30px rgba(255, 34, 0, 0.3),
                            0 0 20px rgba(255, 34, 0, 0.5);
            }
            50% { 
                box-shadow: inset 0 0 40px rgba(255, 34, 0, 0.4),
                            0 0 30px rgba(255, 34, 0, 0.7);
            }
        }

        .status-tile.warning {
            border-color: var(--alert-high);
            background: linear-gradient(135deg, 
                rgba(58, 38, 10, 0.9),
                rgba(42, 28, 10, 0.9));
        }

        .status-tile.safe {
            border-color: var(--alert-normal);
            background: linear-gradient(135deg, 
                rgba(10, 58, 38, 0.9),
                rgba(10, 42, 28, 0.9));
        }

        .tile-icon {
            font-size: 2.5rem;
            margin-bottom: var(--spacing-base);
            filter: drop-shadow(0 0 8px currentColor);
        }

        .status-tile.critical .tile-icon {
            color: var(--emergency-red);
            animation: fireBlaze 1.5s infinite;
        }

        @keyframes fireBlaze {
            0%, 100% { transform: scale(1) rotate(0deg); }
            25% { transform: scale(1.1) rotate(-5deg); }
            75% { transform: scale(1.1) rotate(5deg); }
        }

        .tile-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.1rem;
            font-weight: 700;
            text-align: center;
            margin-bottom: 4px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .tile-subtitle {
            font-size: 0.9rem;
            text-align: center;
            opacity: 0.8;
            color: var(--aluminum);
        }

        /* === CAMERA CONTROL PANEL === */
        .camera-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: var(--spacing-base);
            margin-top: var(--spacing-xwide);
            padding: var(--spacing-base);
            background: rgba(42, 42, 53, 0.6);
            border-radius: var(--border-radius-critical);
            border: 1px solid rgba(255, 85, 0, 0.2);
        }

        .camera-option-btn {
            background: linear-gradient(135deg, 
                rgba(42, 42, 53, 0.9),
                rgba(58, 42, 53, 0.9));
            border: 2px solid rgba(255, 85, 0, 0.3);
            border-radius: var(--border-radius-critical);
            padding: var(--spacing-base);
            color: var(--aluminum);
            font-family: 'Orbitron', sans-serif;
            font-weight: 600;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .camera-option-btn:hover {
            border-color: var(--fire-orange);
            background: linear-gradient(135deg, 
                rgba(58, 42, 53, 0.9),
                rgba(74, 42, 53, 0.9));
            transform: translateY(-2px);
        }

        .camera-option-btn.active {
            border-color: var(--fire-orange);
            background: linear-gradient(135deg, 
                rgba(255, 85, 0, 0.2),
                rgba(255, 34, 0, 0.2));
        }

        .camera-option-btn i {
            font-size: 1.5rem;
            color: var(--fire-orange);
        }

        /* === SURVEILLANCE PANEL === */
        .surveillance-panel {
            grid-column: span 2;
            background: var(--card-gradient);
            border-radius: var(--border-radius-tactical);
            padding: var(--spacing-xwide);
            border: var(--border-tactical);
            box-shadow: var(--shadow-deep);
        }

        .camera-feed {
            width: 100%;
            height: 400px;
            background: #000;
            border-radius: var(--border-radius-critical);
            overflow: hidden;
            position: relative;
            border: 3px solid rgba(255, 85, 0, 0.4);
            box-shadow: inset 0 0 30px rgba(0, 0, 0, 0.8);
        }

        .camera-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, 
                rgba(26, 26, 37, 0.9) 25%, 
                rgba(42, 26, 37, 0.9) 25%, 
                rgba(42, 26, 37, 0.9) 50%, 
                rgba(26, 26, 37, 0.9) 50%, 
                rgba(26, 26, 37, 0.9) 75%, 
                rgba(42, 26, 37, 0.9) 75%);
            background-size: 40px 40px;
            animation: scanMove 4s linear infinite;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        @keyframes scanMove {
            0% { background-position: 0 0; }
            100% { background-position: 40px 40px; }
        }

        .camera-label {
            position: absolute;
            top: 12px;
            left: 12px;
            background: rgba(255, 34, 0, 0.9);
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            font-size: 0.9rem;
            letter-spacing: 1px;
            text-transform: uppercase;
            box-shadow: var(--glow-critical);
            z-index: 10;
        }

        .recording-indicator {
            position: absolute;
            top: 12px;
            right: 12px;
            background: var(--emergency-red);
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            font-size: 0.9rem;
            letter-spacing: 1px;
            text-transform: uppercase;
            box-shadow: var(--glow-critical);
            z-index: 10;
            display: none;
            align-items: center;
            gap: 8px;
            animation: pulseCritical 1s infinite;
        }

        .recording-indicator i {
            animation: recordingPulse 1s infinite;
        }

        @keyframes recordingPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* CAMERA CONTROLS */
        .camera-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: var(--spacing-base);
            margin-top: var(--spacing-xwide);
        }

        .control-button {
            background: linear-gradient(135deg, 
                rgba(255, 85, 0, 0.9),
                rgba(255, 34, 0, 0.9));
            border: none;
            border-radius: var(--border-radius-critical);
            padding: var(--spacing-wide);
            color: white;
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 4px 15px rgba(255, 34, 0, 0.3);
            min-height: 90px;
            justify-content: center;
        }

        .control-button:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 8px 25px rgba(255, 34, 0, 0.5);
            background: linear-gradient(135deg, 
                rgba(255, 107, 53, 0.9),
                rgba(255, 85, 0, 0.9));
        }

        .control-button:active {
            transform: translateY(0) scale(0.98);
        }

        .control-button.recording {
            background: linear-gradient(135deg, 
                var(--emergency-red),
                #CC0000);
            animation: pulseCritical 1s infinite;
        }

        .control-button.water {
            background: linear-gradient(135deg, 
                var(--water-blue),
                var(--command-blue));
        }

        .control-button.water:hover {
            background: linear-gradient(135deg, 
                #00C8FF,
                var(--water-blue));
            box-shadow: 0 8px 25px rgba(0, 168, 255, 0.5);
        }

        .control-button.success {
            background: linear-gradient(135deg, 
                var(--alert-normal),
                #00CC88);
        }

        .control-button.success:hover {
            background: linear-gradient(135deg, 
                #00FF88,
                var(--alert-normal));
            box-shadow: 0 8px 25px rgba(0, 255, 136, 0.5);
        }

        .control-button.secondary {
            background: linear-gradient(135deg, 
                var(--water-blue),
                var(--command-blue));
        }

        .control-button.disabled {
            background: linear-gradient(135deg, 
                #666, 
                #888);
            cursor: not-allowed;
            opacity: 0.6;
        }

        .control-button.disabled:hover {
            transform: none;
            box-shadow: 0 4px 15px rgba(255, 34, 0, 0.3);
        }

        /* === GALLERY PANEL === */
        .gallery-panel {
            background: var(--card-gradient);
            border-radius: var(--border-radius-tactical);
            padding: var(--spacing-xwide);
            border: var(--border-tactical);
            box-shadow: var(--shadow-deep);
            margin-top: var(--spacing-xwide);
        }

        .gallery-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-xwide);
            padding-bottom: var(--spacing-base);
            border-bottom: 1px solid rgba(255, 85, 0, 0.3);
        }

        .gallery-tabs {
            display: flex;
            gap: var(--spacing-base);
            margin-bottom: var(--spacing-xwide);
        }

        .gallery-tab {
            background: rgba(42, 42, 53, 0.8);
            border: 2px solid rgba(255, 85, 0, 0.3);
            border-radius: var(--border-radius-critical);
            padding: var(--spacing-base) var(--spacing-wide);
            color: var(--aluminum);
            font-family: 'Orbitron', sans-serif;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .gallery-tab:hover {
            border-color: var(--fire-orange);
            background: rgba(58, 42, 53, 0.9);
        }

        .gallery-tab.active {
            border-color: var(--fire-orange);
            background: linear-gradient(135deg, 
                rgba(255, 85, 0, 0.2),
                rgba(255, 34, 0, 0.2));
        }

        .gallery-container {
            max-height: 400px;
            overflow-y: auto;
            background: rgba(17, 17, 24, 0.9);
            border-radius: var(--border-radius-critical);
            padding: var(--spacing-base);
            border: 1px solid rgba(255, 85, 0, 0.2);
        }

        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: var(--spacing-base);
        }

        .gallery-item {
            background: rgba(42, 42, 53, 0.8);
            border-radius: var(--border-radius-critical);
            overflow: hidden;
            border: 2px solid rgba(255, 85, 0, 0.3);
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            aspect-ratio: 16/9;
        }

        .gallery-item:hover {
            transform: translateY(-5px);
            border-color: var(--fire-orange);
            box-shadow: 0 10px 20px rgba(255, 85, 0, 0.3);
        }

        .gallery-item img,
        .gallery-item video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .gallery-item-info {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.8);
            padding: var(--spacing-tight);
            font-size: 0.75rem;
            color: var(--aluminum);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .gallery-item-type {
            background: var(--fire-orange);
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .gallery-item-actions {
            display: flex;
            gap: 4px;
        }

        .gallery-item-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: var(--aluminum);
            width: 24px;
            height: 24px;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .gallery-item-btn:hover {
            background: rgba(255, 85, 0, 0.8);
            color: white;
        }

        .empty-gallery {
            text-align: center;
            padding: var(--spacing-ultra);
            color: var(--aluminum);
            opacity: 0.5;
        }

        .empty-gallery i {
            font-size: 3rem;
            margin-bottom: var(--spacing-base);
            color: var(--fire-orange);
        }

        /* === SENSOR DISPLAY === */
        .sensor-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: var(--spacing-base);
            margin-top: var(--spacing-xwide);
            background: rgba(255, 85, 0, 0.05);
            padding: var(--spacing-base);
            border-radius: var(--border-radius-critical);
            border: 1px solid rgba(255, 85, 0, 0.1);
        }

        .sensor-item {
            text-align: center;
            padding: var(--spacing-base);
            background: rgba(42, 42, 53, 0.8);
            border-radius: var(--border-radius-critical);
            border: 1px solid rgba(255, 85, 0, 0.2);
        }

        .sensor-label {
            font-size: 0.85rem;
            color: var(--aluminum);
            opacity: 0.8;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .sensor-value {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--aluminum);
        }

        .sensor-value.critical {
            color: var(--emergency-red);
            text-shadow: 0 0 10px rgba(255, 34, 0, 0.5);
            animation: pulseCritical 1s infinite;
        }

        .sensor-value.warning {
            color: var(--hazard-yellow);
        }

        .sensor-value.safe {
            color: var(--alert-normal);
        }

        /* === SYSTEMS PANEL === */
        .systems-panel {
            background: var(--card-gradient);
            border-radius: var(--border-radius-tactical);
            padding: var(--spacing-xwide);
            border: var(--border-tactical);
            box-shadow: var(--shadow-deep);
        }

        .system-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--spacing-base);
        }

        .metric-card {
            background: rgba(42, 42, 53, 0.8);
            border-radius: var(--border-radius-critical);
            padding: var(--spacing-wide);
            border: 1px solid rgba(255, 85, 0, 0.2);
            transition: all 0.3s ease;
        }

        .metric-card:hover {
            border-color: var(--fire-orange);
            box-shadow: 0 5px 20px rgba(255, 85, 0, 0.2);
        }

        .metric-label {
            font-size: 0.85rem;
            color: var(--aluminum);
            opacity: 0.8;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .metric-value {
            font-family: 'Orbitron', sans-serif;
            font-size: 2rem;
            font-weight: 700;
            color: var(--aluminum);
            margin-bottom: 4px;
        }

        .metric-value.critical {
            color: var(--emergency-red);
            text-shadow: 0 0 10px rgba(255, 34, 0, 0.5);
        }

        .metric-value.warning {
            color: var(--hazard-yellow);
        }

        .metric-value.safe {
            color: var(--alert-normal);
        }

        .metric-trend {
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .metric-trend.up {
            color: var(--alert-normal);
        }

        .metric-trend.down {
            color: var(--emergency-red);
        }

        /* === LOG PANEL === */
        .log-panel {
            background: var(--card-gradient);
            border-radius: var(--border-radius-tactical);
            padding: var(--spacing-xwide);
            border: var(--border-tactical);
            box-shadow: var(--shadow-deep);
            margin-top: var(--spacing-xwide);
        }

        .log-container {
            max-height: 300px;
            overflow-y: auto;
            background: rgba(17, 17, 24, 0.9);
            border-radius: var(--border-radius-critical);
            padding: var(--spacing-base);
            border: 1px solid rgba(255, 85, 0, 0.2);
        }

        .log-entry {
            padding: var(--spacing-base);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: flex-start;
            gap: var(--spacing-base);
            transition: background 0.2s ease;
            border-left: 4px solid transparent;
        }

        .log-entry:hover {
            background: rgba(255, 85, 0, 0.05);
        }

        .log-entry.alert {
            border-left-color: var(--emergency-red);
            color: var(--emergency-red);
        }

        .log-entry.water {
            border-left-color: var(--water-blue);
            color: var(--water-blue);
        }

        .log-entry.safe {
            border-left-color: var(--alert-normal);
            color: var(--alert-normal);
        }

        .log-entry.info {
            border-left-color: var(--hazard-yellow);
            color: var(--hazard-yellow);
        }

        .log-entry.arduino {
            border-left-color: var(--thermal-purple);
            color: var(--thermal-purple);
        }

        .log-entry.media {
            border-left-color: var(--fire-orange);
            color: var(--fire-orange);
        }

        .log-time {
            font-family: 'Orbitron', sans-serif;
            font-size: 0.8rem;
            color: var(--aluminum);
            opacity: 0.8;
            min-width: 70px;
            flex-shrink: 0;
        }

        .log-message {
            flex: 1;
            word-break: break-word;
            font-size: 0.9rem;
        }

        /* === EMERGENCY ALERT MODAL === */
        .emergency-alert {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(10, 10, 15, 0.95);
            backdrop-filter: blur(20px);
            z-index: 10000;
            display: none;
            align-items: center;
            justify-content: center;
            animation: alertFadeIn 0.3s ease;
        }

        @keyframes alertFadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .alert-container {
            background: linear-gradient(135deg, 
                rgba(58, 10, 10, 0.95),
                rgba(42, 10, 10, 0.95));
            border: 4px solid var(--emergency-red);
            border-radius: var(--border-radius-tactical);
            padding: var(--spacing-ultra);
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            animation: alertPulse 2s infinite;
            box-shadow: 
                0 0 60px rgba(255, 34, 0, 0.8),
                inset 0 0 30px rgba(255, 34, 0, 0.3);
        }

        @keyframes alertPulse {
            0%, 100% { 
                box-shadow: 
                    0 0 60px rgba(255, 34, 0, 0.8),
                    inset 0 0 30px rgba(255, 34, 0, 0.3);
                border-color: var(--emergency-red);
            }
            50% { 
                box-shadow: 
                    0 0 100px rgba(255, 34, 0, 1),
                    inset 0 0 50px rgba(255, 34, 0, 0.5);
                border-color: #FF5500;
            }
        }

        .alert-icon {
            font-size: 5rem;
            color: var(--emergency-red);
            text-align: center;
            margin-bottom: var(--spacing-xwide);
            animation: alertIcon 1s infinite;
            filter: drop-shadow(0 0 20px rgba(255, 34, 0, 0.8));
        }

        @keyframes alertIcon {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }

        .alert-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 2.5rem;
            color: white;
            text-align: center;
            margin-bottom: var(--spacing-wide);
            text-shadow: 
                0 0 10px rgba(255, 34, 0, 0.8),
                0 0 20px rgba(255, 34, 0, 0.6);
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .alert-content {
            background: rgba(0, 0, 0, 0.6);
            padding: var(--spacing-xwide);
            border-radius: var(--border-radius-critical);
            border: 2px solid rgba(255, 85, 0, 0.5);
            margin: var(--spacing-xwide) 0;
        }

        .alert-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--spacing-base);
        }

        .info-item {
            display: flex;
            align-items: center;
            gap: var(--spacing-base);
        }

        .info-icon {
            color: var(--hazard-yellow);
            font-size: 1.2rem;
            width: 24px;
        }

        .info-label {
            font-weight: 600;
            color: var(--aluminum);
            min-width: 100px;
        }

        .info-value {
            color: white;
            font-weight: 700;
        }

        .alert-actions {
            display: grid;
            grid-template-columns: 1fr;
            gap: var(--spacing-base);
            margin-top: var(--spacing-xwide);
        }

        .alert-button {
            background: linear-gradient(135deg, 
                var(--emergency-red),
                #CC0000);
            border: none;
            border-radius: var(--border-radius-critical);
            padding: var(--spacing-xwide);
            color: white;
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 2px;
            box-shadow: 0 6px 20px rgba(255, 34, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-base);
        }

        .alert-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 30px rgba(255, 34, 0, 0.7);
        }

        /* === NOTIFICATION SYSTEM === */
        .notification-center {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            max-width: 400px;
            width: calc(100% - 40px);
        }

        .notification {
            background: rgba(26, 26, 37, 0.95);
            border-left: 4px solid var(--fire-orange);
            padding: var(--spacing-wide);
            margin-bottom: var(--spacing-base);
            border-radius: var(--border-radius-critical);
            box-shadow: var(--shadow-deep);
            transform: translateX(100%);
            animation: notificationSlide 0.3s ease forwards;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 85, 0, 0.2);
        }

        @keyframes notificationSlide {
            to { transform: translateX(0); }
        }

        .notification.critical {
            border-left-color: var(--emergency-red);
            background: rgba(58, 10, 10, 0.95);
        }

        .notification.warning {
            border-left-color: var(--hazard-yellow);
            background: rgba(58, 38, 10, 0.95);
        }

        .notification.safe {
            border-left-color: var(--alert-normal);
            background: rgba(10, 58, 38, 0.95);
        }

        .notification.media {
            border-left-color: var(--fire-orange);
            background: rgba(58, 42, 10, 0.95);
        }

        .notification-title {
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            color: var(--aluminum);
            font-size: 1rem;
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .notification-message {
            color: var(--aluminum);
            font-size: 0.9rem;
            line-height: 1.4;
        }

        /* === MEDIA VIEWER MODAL === */
        .media-viewer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(10, 10, 15, 0.98);
            backdrop-filter: blur(20px);
            z-index: 10001;
            display: none;
            align-items: center;
            justify-content: center;
            animation: alertFadeIn 0.3s ease;
        }

        .media-container {
            background: var(--card-gradient);
            border: 3px solid var(--fire-orange);
            border-radius: var(--border-radius-tactical);
            max-width: 90%;
            max-height: 90vh;
            overflow: hidden;
            position: relative;
            box-shadow: var(--glow-critical), var(--shadow-deep);
        }

        .media-content {
            max-width: 100%;
            max-height: 80vh;
            object-fit: contain;
        }

        .media-info {
            background: rgba(0, 0, 0, 0.8);
            padding: var(--spacing-wide);
            color: var(--aluminum);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .media-close {
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--emergency-red);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 1.5rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
            box-shadow: var(--glow-critical);
        }

        .media-controls {
            position: absolute;
            bottom: 20px;
            left: 0;
            right: 0;
            display: flex;
            justify-content: center;
            gap: var(--spacing-base);
            z-index: 10;
        }

        .media-control-btn {
            background: rgba(255, 85, 0, 0.9);
            color: white;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-size: 1.2rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .media-control-btn:hover {
            background: var(--emergency-red);
            transform: scale(1.1);
        }

        /* === RESPONSIVE DESIGN === */
        @media (max-width: 1200px) {
            .tactical-grid {
                grid-template-columns: 1fr;
            }
            
            .surveillance-panel {
                grid-column: 1;
            }
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: var(--spacing-wide);
            }
            
            .status-indicator {
                width: 100%;
                justify-content: center;
            }
            
            .emergency-logo {
                font-size: 2.2rem;
            }
            
            .camera-feed {
                height: 300px;
            }
            
            .sensor-grid {
                grid-template-columns: 1fr;
            }
            
            .camera-controls {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .system-metrics {
                grid-template-columns: 1fr;
            }
            
            .gallery-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 480px) {
            .tactical-grid {
                padding: var(--spacing-base);
                gap: var(--spacing-wide);
            }
            
            .status-grid {
                grid-template-columns: 1fr;
            }
            
            .camera-controls {
                grid-template-columns: 1fr;
            }
            
            .emergency-logo {
                font-size: 1.8rem;
                letter-spacing: 2px;
            }
            
            .camera-feed {
                height: 250px;
            }
            
            .gallery-grid {
                grid-template-columns: 1fr;
            }
            
            .alert-container {
                padding: var(--spacing-xwide);
            }
            
            .alert-title {
                font-size: 2rem;
            }
        }

        /* === UTILITY CLASSES === */
        .text-center { text-align: center; }
        .mt-1 { margin-top: var(--spacing-tight); }
        .mt-2 { margin-top: var(--spacing-base); }
        .mt-3 { margin-top: var(--spacing-wide); }
        .mt-4 { margin-top: var(--spacing-xwide); }
        .mb-1 { margin-bottom: var(--spacing-tight); }
        .mb-2 { margin-bottom: var(--spacing-base); }
        .mb-3 { margin-bottom: var(--spacing-wide); }
        .mb-4 { margin-bottom: var(--spacing-xwide); }

        /* Loading Overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(10, 10, 15, 0.9);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid transparent;
            border-top: 4px solid var(--fire-orange);
            border-right: 4px solid var(--water-blue);
            border-bottom: 4px solid var(--alert-normal);
            border-left: 4px solid var(--emergency-red);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Arduino Fire Alert Overlay */
        .arduino-fire-alert {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 34, 0, 0.9);
            color: white;
            padding: 15px 25px;
            border-radius: 12px;
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            font-size: 1.2rem;
            z-index: 100;
            animation: alertPulse 1s infinite;
            text-align: center;
            border: 3px solid white;
            box-shadow: 0 0 30px rgba(255, 34, 0, 0.8);
            display: none;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Test Fire Alert Button */
        .test-fire-button {
            background: linear-gradient(135deg, 
                var(--hazard-yellow),
                var(--fire-orange));
            border: none;
            border-radius: var(--border-radius-critical);
            padding: var(--spacing-wide);
            color: white;
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 4px 15px rgba(255, 170, 0, 0.3);
            min-height: 90px;
            justify-content: center;
            margin-top: var(--spacing-base);
        }

        .test-fire-button:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 8px 25px rgba(255, 170, 0, 0.5);
            background: linear-gradient(135deg, 
                var(--fire-orange),
                var(--emergency-red));
        }

        /* Camera input fields */
        .camera-input-group {
            margin-top: var(--spacing-base);
            display: flex;
            flex-direction: column;
            gap: var(--spacing-base);
        }

        .camera-input {
            width: 100%;
            padding: var(--spacing-base);
            border-radius: var(--border-radius-critical);
            background: rgba(42, 42, 53, 0.8);
            border: 2px solid rgba(255, 85, 0, 0.3);
            color: var(--aluminum);
            font-family: 'Montserrat', sans-serif;
            font-size: 0.9rem;
        }

        .camera-input:focus {
            outline: none;
            border-color: var(--fire-orange);
            box-shadow: 0 0 10px rgba(255, 85, 0, 0.5);
        }

        /* Accessibility */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* High Contrast Mode */
        @media (prefers-contrast: high) {
            :root {
                --emergency-red: #FF0000;
                --fire-orange: #FF5500;
                --hazard-yellow: #FFFF00;
                --aluminum: #FFFFFF;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
    </div>

    <!-- Emergency Alert Modal -->
    <div id="emergencyAlert" class="emergency-alert">
        <div class="alert-container">
            <div class="alert-icon">
                <i class="fas fa-fire"></i>
            </div>
            <h1 class="alert-title">FIRE EMERGENCY</h1>
            <div class="alert-content">
                <div class="alert-info">
                    <div class="info-item">
                        <i class="fas fa-map-marker-alt info-icon"></i>
                        <span class="info-label">Location:</span>
                        <span class="info-value" id="alertLocation">Test Fire Alert</span>
                    </div>
                    <div class="info-item">
                        <i class="fas fa-fire info-icon"></i>
                        <span class="info-label">Severity:</span>
                        <span class="info-value" id="alertSeverity" style="color: var(--emergency-red);">TEST ALERT</span>
                    </div>
                    <div class="info-item">
                        <i class="fas fa-clock info-icon"></i>
                        <span class="info-label">Time:</span>
                        <span class="info-value" id="alertTime">00:00:00</span>
                    </div>
                    <div class="info-item">
                        <i class="fas fa-tint info-icon"></i>
                        <span class="info-label">Response:</span>
                        <span class="info-value" style="color: var(--water-blue);">TEST MODE</span>
                    </div>
                </div>
            </div>
            <div class="alert-actions">
                <button class="alert-button" onclick="app.acknowledgeAlert()">
                    <i class="fas fa-bell-slash"></i>
                    ACKNOWLEDGE & STOP ALARM
                </button>
            </div>
        </div>
    </div>

    <!-- Media Viewer Modal -->
    <div id="mediaViewer" class="media-viewer">
        <div class="media-container">
            <button class="media-close" onclick="app.closeMediaViewer()">
                <i class="fas fa-times"></i>
            </button>
            <div id="mediaContent"></div>
            <div class="media-controls" id="videoControls" style="display: none;">
                <button class="media-control-btn" onclick="app.toggleVideoPlayback()">
                    <i class="fas fa-play" id="videoPlayBtn"></i>
                </button>
                <button class="media-control-btn" onclick="app.toggleVideoMute()">
                    <i class="fas fa-volume-up" id="videoMuteBtn"></i>
                </button>
                <button class="media-control-btn" onclick="app.downloadCurrentMedia()">
                    <i class="fas fa-download"></i>
                </button>
            </div>
            <div class="media-info" id="mediaInfo"></div>
        </div>
    </div>

    <!-- Notification Center -->
    <div class="notification-center" id="notificationCenter"></div>

    <!-- Emergency Header -->
    <div class="emergency-header">
        <div class="header-content">
            <div class="logo-section">
                <i class="fas fa-fire-extinguisher emergency-icon"></i>
                <h1 class="emergency-logo">APULA</h1>
            </div>
            <div class="status-indicator">
                <div class="status-item">
                    <span class="status-dot critical" id="systemStatusDot"></span>
                    <span class="status-text" id="systemStatusText">SYSTEM: READY</span>
                </div>
                <div class="status-item">
                    <span class="status-dot warning" id="arduinoStatusDot"></span>
                    <span class="status-text" id="arduinoStatusText">ARDUINO: OFFLINE</span>
                </div>
                <div class="status-item">
                    <span class="status-dot safe" id="cameraStatusDot"></span>
                    <span class="status-text" id="cameraStatusText">CAMERA: READY</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Tactical Dashboard Grid -->
    <div class="tactical-grid">
        <!-- Emergency Status Panel -->
        <div class="status-panel">
            <div class="panel-header">
                <div class="panel-icon">
                    <i class="fas fa-shield-alt"></i>
                </div>
                <h2 class="panel-title">System Status</h2>
            </div>
            <div class="status-grid">
                <div class="status-tile" id="fireStatusTile">
                    <i class="fas fa-fire tile-icon"></i>
                    <div class="tile-title" id="fireStatusText">NO FIRE</div>
                    <div class="tile-subtitle">System Normal</div>
                </div>
                
                <div class="status-tile" id="waterStatusTile">
                    <i class="fas fa-tint tile-icon"></i>
                    <div class="tile-title" id="waterStatusText">WATER READY</div>
                    <!-- Replaced Pressure with Time/Date -->
                    <div class="tile-subtitle" id="currentDateTime">--:-- -- MM/DD/YYYY</div>
                </div>
                
                <div class="status-tile" id="arduinoTile">
                    <i class="fas fa-microchip tile-icon"></i>
                    <div class="tile-title" id="arduinoTileText">ARDUINO OFFLINE</div>
                    <div class="tile-subtitle">Click to Connect</div>
                </div>
                
                <div class="status-tile" id="cameraTile">
                    <i class="fas fa-video tile-icon"></i>
                    <div class="tile-title" id="cameraTileText">CAMERA OFFLINE</div>
                    <div class="tile-subtitle">Click to Connect</div>
                </div>
            </div>

            <!-- TEST FIRE ALERT BUTTON -->
            <button class="test-fire-button" onclick="app.triggerTestFireAlert()">
                <i class="fas fa-fire-extinguisher"></i>
                TRIGGER TEST FIRE ALERT
            </button>

            <!-- Camera Options - UPDATED WITH ALL OPTIONS -->
            <div class="camera-options">
                <button class="camera-option-btn" onclick="selectCamera('wifi')" id="wifiBtn">
                    <i class="fas fa-wifi"></i>
                    Wi-Fi
                </button>
                <button class="camera-option-btn" onclick="selectCamera('bluetooth')" id="bluetoothBtn">
                    <i class="fas fa-bluetooth"></i>
                    Bluetooth
                </button>
                <button class="camera-option-btn" onclick="selectCamera('rtsp')" id="rtspBtn">
                    <i class="fas fa-satellite-dish"></i>
                    RTSP
                </button>
                <button class="camera-option-btn active" onclick="selectCamera('webcam')" id="webcamBtn">
                    <i class="fas fa-camera"></i>
                    Webcam
                </button>
            </div>

            <!-- Camera Input Fields -->
            <div id="cameraInputs">
                <!-- RTSP URL Input -->
                <div id="rtspInput" class="camera-input-group" style="display: none;">
                    <input type="text" id="rtspUrl" class="camera-input" 
                           placeholder="rtsp://username:password@192.168.1.100:554/stream1"
                           value="rtsp://184.72.239.149/vod/mp4:BigBuckBunny_175k.mov">
                    <div style="display: flex; gap: var(--spacing-base);">
                        <input type="text" id="rtspUsername" class="camera-input" 
                               placeholder="Username (optional)" style="flex: 1;">
                        <input type="password" id="rtspPassword" class="camera-input" 
                               placeholder="Password (optional)" style="flex: 1;">
                    </div>
                    <button class="control-button" onclick="connectRTSP()">
                        <i class="fas fa-plug"></i>
                        Connect RTSP Stream
                    </button>
                </div>

                <!-- Wi-Fi Camera Input -->
                <div id="wifiInput" class="camera-input-group" style="display: none;">
                    <input type="text" id="wifiIp" class="camera-input" 
                           placeholder="Camera IP Address" value="192.168.1.100">
                    <input type="text" id="wifiPort" class="camera-input" 
                           placeholder="Camera Port" value="8080">
                    <input type="text" id="wifiPath" class="camera-input" 
                           placeholder="Stream Path (optional)" value="video">
                    <button class="control-button" onclick="connectWiFiCamera()">
                        <i class="fas fa-wifi"></i>
                        Connect Wi-Fi Camera
                    </button>
                </div>

                <!-- Bluetooth Camera Instructions -->
                <div id="bluetoothInstructions" style="display: none; margin-top: var(--spacing-base); padding: var(--spacing-base); background: rgba(42, 42, 53, 0.8); border-radius: var(--border-radius-critical); border: 2px solid rgba(255, 85, 0, 0.3);">
                    <h3 style="color: var(--fire-orange); margin-bottom: var(--spacing-base);">
                        <i class="fas fa-bluetooth"></i> Bluetooth Camera Setup
                    </h3>
                    <p style="color: var(--aluminum); font-size: 0.9rem; margin-bottom: var(--spacing-base);">
                        1. Turn on your Bluetooth camera<br>
                        2. Make sure Bluetooth is enabled on your computer<br>
                        3. Click the button below to start simulation<br>
                        4. For real Bluetooth, use your OS pairing utility
                    </p>
                    <button class="control-button" onclick="connectBluetoothCamera()">
                        <i class="fas fa-bluetooth"></i>
                        Start Bluetooth Camera Simulation
                    </button>
                </div>

                <!-- Webcam Instructions -->
                <div id="webcamInstructions" style="display: none; margin-top: var(--spacing-base); padding: var(--spacing-base); background: rgba(42, 42, 53, 0.8); border-radius: var(--border-radius-critical); border: 2px solid rgba(255, 85, 0, 0.3);">
                    <h3 style="color: var(--fire-orange); margin-bottom: var(--spacing-base);">
                        <i class="fas fa-camera"></i> Webcam Access
                    </h3>
                    <p style="color: var(--aluminum); font-size: 0.9rem; margin-bottom: var(--spacing-base);">
                         Click connect to access your local webcam<br>
                         Grant camera permissions when prompted<br>
                         Uses MJPEG streaming for compatibility<br>
                         Works on Windows, macOS, and Linux
                    </p>
                    <button class="control-button" onclick="connectWebcam()">
                        <i class="fas fa-camera"></i>
                        Connect to Webcam
                    </button>
                </div>
            </div>

            <!-- Sensor Display -->
            <div class="sensor-grid" id="sensorDisplay" style="display: none;">
                <div class="sensor-item">
                    <div class="sensor-label">Flame Sensor 1 (D2)</div>
                    <div class="sensor-value safe" id="sensor1Value"> OK</div>
                </div>
                <div class="sensor-item">
                    <div class="sensor-label">Flame Sensor 2 (D3)</div>
                    <div class="sensor-value safe" id="sensor2Value"> OK</div>
                </div>
                <div class="sensor-item">
                    <div class="sensor-label">Flame Sensor 3 (D4)</div>
                    <div class="sensor-value safe" id="sensor3Value"> OK</div>
                </div>
            </div>

            <!-- Arduino Fire Alert -->
            <div id="arduinoFireAlert" class="arduino-fire-alert">
                <i class="fas fa-fire" style="margin-right: 10px;"></i>
                ARDUINO FIRE ALERT!
                <div style="font-size: 0.9rem; margin-top: 5px;" id="arduinoAlertLocation"></div>
            </div>
        </div>

        <!-- Surveillance Panel -->
        <div class="surveillance-panel">
            <div class="panel-header">
                <div class="panel-icon">
                    <i class="fas fa-eye"></i>
                </div>
                <h2 class="panel-title">Live Surveillance</h2>
                <div class="recording-indicator" id="recordingIndicator">
                    <i class="fas fa-circle"></i>
                    RECORDING
                </div>
            </div>
            <div class="camera-feed">
                <div class="camera-label" id="cameraFeedLabel">CAMERA FEED OFFLINE</div>
                <div class="camera-overlay" id="cameraOverlay">
                    <i class="fas fa-camera" style="font-size: 3rem; color: var(--steel-grey); margin-bottom: 20px;"></i>
                    <p style="color: var(--steel-grey); margin-bottom: 20px;">SURVEILLANCE FEED OFFLINE</p>
                    <button class="control-button" onclick="selectCamera('webcam')" id="connectCameraBtn">
                        <i class="fas fa-plug"></i>
                        SELECT CAMERA TYPE
                    </button>
                </div>
                <video id="cameraFeed" autoplay playsinline style="width: 100%; height: 100%; object-fit: cover; display: none;"></video>
                <!-- MJPEG stream will be inserted here -->
            </div>
            <div class="camera-controls">
                <button class="control-button" onclick="app.startRecording()" id="recordBtn">
                    <i class="fas fa-record-vinyl"></i>
                    Start Recording
                </button>
                <button class="control-button disabled" onclick="app.stopRecording()" id="stopBtn">
                    <i class="fas fa-stop"></i>
                    Stop Recording
                </button>
                <button class="control-button secondary" onclick="app.captureSnapshot()" id="snapshotBtn">
                    <i class="fas fa-camera"></i>
                    Take Snapshot
                </button>
                <button class="control-button water" onclick="app.activateWater()" id="activateWaterBtn">
                    <i class="fas fa-tint"></i>
                    Activate Water
                </button>
            </div>
        </div>

        <!-- Gallery Panel -->
        <div class="gallery-panel">
            <div class="panel-header">
                <div class="panel-icon">
                    <i class="fas fa-images"></i>
                </div>
                <h2 class="panel-title">Media Gallery</h2>
                <button class="control-button" onclick="app.clearGallery()" style="padding: 8px 16px; font-size: 0.8rem;">
                    <i class="fas fa-trash"></i>
                    Clear All
                </button>
            </div>
            <div class="gallery-tabs">
                <button class="gallery-tab active" onclick="app.showGalleryTab('all')" id="tabAll">
                    <i class="fas fa-th"></i>
                    All Media
                </button>
                <button class="gallery-tab" onclick="app.showGalleryTab('photos')" id="tabPhotos">
                    <i class="fas fa-camera"></i>
                    Photos
                </button>
                <button class="gallery-tab" onclick="app.showGalleryTab('videos')" id="tabVideos">
                    <i class="fas fa-video"></i>
                    Videos
                </button>
            </div>
            <div class="gallery-container" id="galleryContainer">
                <div class="gallery-grid" id="galleryGrid">
                    <!-- Gallery items will be dynamically added here -->
                </div>
                <div class="empty-gallery" id="emptyGallery">
                    <i class="fas fa-images"></i>
                    <h3>No Media Available</h3>
                    <p>Start recording or take snapshots to populate the gallery</p>
                </div>
            </div>
        </div>

        <!-- Systems Panel -->
        <div class="systems-panel">
            <div class="panel-header">
                <div class="panel-icon">
                    <i class="fas fa-chart-bar"></i>
                </div>
                <h2 class="panel-title">System Metrics</h2>
            </div>
            <div class="system-metrics">
                <div class="metric-card">
                    <div class="metric-label">Active Cameras</div>
                    <div class="metric-value" id="metricCameras">0/1</div>
                    <div class="metric-trend down">
                        <i class="fas fa-arrow-down"></i>
                        <span>OFFLINE</span>
                    </div>
                </div>
                
                <div class="metric-card">
                    <div class="metric-label">Fire Detections</div>
                    <div class="metric-value safe" id="metricFires">0</div>
                    <div class="metric-trend up">
                        <i class="fas fa-check"></i>
                        <span>NORMAL</span>
                    </div>
                </div>
                
                <div class="metric-card">
                    <div class="metric-label">Water Activations</div>
                    <div class="metric-value safe" id="metricWater">0</div>
                    <div class="metric-trend up">
                        <i class="fas fa-check"></i>
                        <span>READY</span>
                    </div>
                </div>
                
                <div class="metric-card">
                    <div class="metric-label">Media Files</div>
                    <div class="metric-value" id="metricMedia">0</div>
                    <div class="metric-trend up">
                        <i class="fas fa-folder"></i>
                        <span>GALLERY</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Log Panel -->
        <div class="log-panel">
            <div class="panel-header">
                <div class="panel-icon">
                    <i class="fas fa-clipboard-list"></i>
                </div>
                <h2 class="panel-title">System Logs</h2>
                <button class="control-button" onclick="app.clearLogs()" style="padding: 8px 16px; font-size: 0.8rem;">
                    <i class="fas fa-trash"></i>
                    Clear Logs
                </button>
            </div>
            <div class="log-container" id="logContainer">
                <div class="log-entry info">
                    <span class="log-time">00:00:00</span>
                    <span class="log-message">System initialized successfully</span>
                </div>
                <div class="log-entry info">
                    <span class="log-time">00:00:01</span>
                    <span class="log-message">Emergency dashboard activated</span>
                </div>
                <div class="log-entry water">
                    <span class="log-time">00:00:02</span>
                    <span class="log-message">Water control system ready</span>
                </div>
                <div class="log-entry">
                    <span class="log-time">00:00:03</span>
                    <span class="log-message">Select camera type to connect hardware</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Audio for Fire Alarm -->
    <audio id="fireAlarmSound" preload="auto" loop>
        <source src="https://www.soundjay.com/ambient/sounds/fire-truck-siren-01.mp3" type="audio/mpeg">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-emergency-air-siren-1646.mp3" type="audio/mpeg">
    </audio>

    <script>
        // === ENHANCED CAMERA CONNECTION FUNCTIONS ===
        
        // Global camera state
        let currentCameraType = 'webcam';
        let cameraStreamActive = false;
        
        // Camera type selection
        function selectCamera(type) {
            console.log(`Selecting camera type: ${type}`);
            currentCameraType = type;
            
            // Update active button
            const buttons = document.querySelectorAll('.camera-option-btn');
            buttons.forEach(btn => btn.classList.remove('active'));
            document.getElementById(`${type}Btn`).classList.add('active');
            
            // Hide all input fields
            document.getElementById('rtspInput').style.display = 'none';
            document.getElementById('wifiInput').style.display = 'none';
            document.getElementById('bluetoothInstructions').style.display = 'none';
            document.getElementById('webcamInstructions').style.display = 'none';
            
            // Show appropriate input based on selection
            switch(type) {
                case 'rtsp':
                    document.getElementById('rtspInput').style.display = 'block';
                    app.showNotification('RTSP SELECTED', 'Enter RTSP stream URL', 'info');
                    app.addLog('RTSP camera type selected', 'info');
                    break;
                case 'wifi':
                    document.getElementById('wifiInput').style.display = 'block';
                    app.showNotification('Wi-Fi SELECTED', 'Enter Wi-Fi camera IP and port', 'info');
                    app.addLog('Wi-Fi camera type selected', 'info');
                    break;
                case 'bluetooth':
                    document.getElementById('bluetoothInstructions').style.display = 'block';
                    app.showNotification('BLUETOOTH SELECTED', 'Bluetooth camera simulation available', 'info');
                    app.addLog('Bluetooth camera type selected', 'info');
                    break;
                case 'webcam':
                    document.getElementById('webcamInstructions').style.display = 'block';
                    app.showNotification('WEBCAM SELECTED', 'Local webcam access available', 'info');
                    app.addLog('Webcam type selected', 'info');
                    break;
            }
            
            // Update connect button
            const connectBtn = document.getElementById('connectCameraBtn');
            connectBtn.innerHTML = `<i class="fas fa-plug"></i> CONNECT ${type.toUpperCase()}`;
        }
        
        // RTSP Connection
        async function connectRTSP() {
            const rtspUrl = document.getElementById('rtspUrl').value;
            const username = document.getElementById('rtspUsername').value;
            const password = document.getElementById('rtspPassword').value;
            
            if (!rtspUrl) {
                app.showNotification('RTSP ERROR', 'Please enter RTSP URL', 'warning');
                return;
            }

            app.showNotification('RTSP CONNECTION', 'Connecting to RTSP stream...', 'info');
            app.addLog(`Connecting to RTSP: ${rtspUrl}`, 'info');

            // Test RTSP connection first
            try {
                const response = await fetch('/api/test-rtsp', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ url: rtspUrl })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    // Get stream URL from server
                    const streamResponse = await fetch('/api/camera/connect', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ 
                            type: 'rtsp', 
                            url: rtspUrl,
                            username: username,
                            password: password
                        })
                    });
                    
                    const streamData = await streamResponse.json();
                    displayCameraStream(streamData.streamUrl, 'RTSP STREAM');
                    
                    app.showNotification('RTSP CONNECTED', 'RTSP stream connected successfully', 'safe');
                    app.addLog('RTSP stream connected', 'info');
                } else {
                    throw new Error('RTSP stream not reachable');
                }
            } catch (error) {
                console.error('RTSP connection error:', error);
                app.showNotification('RTSP ERROR', `Failed to connect: ${error.message}`, 'warning');
                app.addLog(`RTSP connection failed: ${error.message}`, 'info');
                
                // Fallback to test pattern
                displayCameraStream('/bluetooth-camera', 'RTSP FALLBACK');
            }
        }
        
        // Wi-Fi Camera Connection
        async function connectWiFiCamera() {
            const wifiIp = document.getElementById('wifiIp').value || '192.168.1.100';
            const wifiPort = document.getElementById('wifiPort').value || '8080';
            const wifiPath = document.getElementById('wifiPath').value || 'video';
            
            app.showNotification('Wi-Fi CONNECTION', `Connecting to ${wifiIp}:${wifiPort}...`, 'info');
            app.addLog(`Connecting to Wi-Fi camera: ${wifiIp}:${wifiPort}`, 'info');
            
            try {
                const response = await fetch('/api/camera/connect', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        type: 'wifi', 
                        ip: wifiIp, 
                        port: wifiPort,
                        path: wifiPath
                    })
                });
                
                const streamData = await response.json();
                displayCameraStream(streamData.streamUrl, 'Wi-Fi CAMERA');
                
                app.showNotification('Wi-Fi CONNECTED', 'Wi-Fi camera stream started', 'safe');
                app.addLog('Wi-Fi camera connected', 'info');
            } catch (error) {
                app.showNotification('Wi-Fi ERROR', 'Failed to connect to Wi-Fi camera', 'warning');
                app.addLog(`Wi-Fi connection failed: ${error.message}`, 'info');
            }
        }
        
        // Bluetooth Camera Connection
        async function connectBluetoothCamera() {
            app.showNotification('BLUETOOTH', 'Starting Bluetooth camera simulation...', 'info');
            app.addLog('Connecting Bluetooth camera', 'info');
            
            try {
                const response = await fetch('/api/camera/connect', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ type: 'bluetooth' })
                });
                
                const streamData = await response.json();
                displayCameraStream(streamData.streamUrl, 'BLUETOOTH CAMERA');
                
                app.showNotification('BLUETOOTH CONNECTED', 'Bluetooth camera simulation active', 'safe');
                app.addLog('Bluetooth camera connected', 'info');
            } catch (error) {
                app.showNotification('BLUETOOTH ERROR', 'Bluetooth camera failed', 'warning');
                app.addLog(`Bluetooth connection failed: ${error.message}`, 'info');
            }
        }
        
        // Webcam Connection
        async function connectWebcam() {
            app.showNotification('WEBCAM', 'Accessing local webcam...', 'info');
            app.addLog('Connecting webcam', 'info');
            
            try {
                const response = await fetch('/api/camera/connect', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ type: 'webcam' })
                });
                
                const streamData = await response.json();
                displayCameraStream(streamData.streamUrl, 'WEBCAM');
                
                app.showNotification('WEBCAM CONNECTED', 'Webcam stream started', 'safe');
                app.addLog('Webcam connected', 'info');
            } catch (error) {
                app.showNotification('WEBCAM ERROR', 'Failed to access webcam', 'warning');
                app.addLog(`Webcam connection failed: ${error.message}`, 'info');
            }
        }
        
        // Display Camera Stream
        function displayCameraStream(streamUrl, label) {
            const videoElement = document.getElementById('cameraFeed');
            const cameraOverlay = document.getElementById('cameraOverlay');
            const cameraLabel = document.getElementById('cameraFeedLabel');
            
            // Create image element for MJPEG stream
            const img = document.createElement('img');
            img.id = 'cameraStream';
            img.src = streamUrl;
            img.style.width = '100%';
            img.style.height = '100%';
            img.style.objectFit = 'cover';
            
            // Clear previous stream
            const existingStream = document.getElementById('cameraStream');
            if (existingStream) existingStream.remove();
            
            // Hide overlay and video
            cameraOverlay.style.display = 'none';
            if (videoElement) videoElement.style.display = 'none';
            
            // Add new stream
            const container = videoElement.parentElement;
            container.appendChild(img);
            
            cameraLabel.textContent = `${label} - LIVE`;
            app.camera.isActive = true;
            app.camera.currentType = currentCameraType;
            
            app.stats.activeCameras = 1;
            app.updateCameraStatus();
            app.updateStats();
            
            cameraStreamActive = true;
            
            // Enable recording and snapshot buttons
            document.getElementById('recordBtn').classList.remove('disabled');
            document.getElementById('snapshotBtn').classList.remove('disabled');
        }
        
        // === FIRE ALARM SYSTEM ===
        class FireTruckSiren {
            constructor() {
                this.audioContext = null;
                this.oscillator1 = null;
                this.oscillator2 = null;
                this.gainNode = null;
                this.isPlaying = false;
                this.sirenInterval = null;
                this.volume = 0.8;
            }
            
            initializeAudioContext() {
                if (!this.audioContext) {
                    try {
                        this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                        console.log('Audio Context initialized');
                    } catch (error) {
                        console.error('Failed to initialize Audio Context:', error);
                        return false;
                    }
                }
                return true;
            }
            
            createSirenSound() {
                if (!this.initializeAudioContext()) {
                    console.error('Cannot create siren - Audio Context failed');
                    return false;
                }
                
                this.oscillator1 = this.audioContext.createOscillator();
                this.oscillator2 = this.audioContext.createOscillator();
                this.gainNode = this.audioContext.createGain();
                
                this.oscillator1.connect(this.gainNode);
                this.oscillator2.connect(this.gainNode);
                this.gainNode.connect(this.audioContext.destination);
                
                this.oscillator1.type = 'sawtooth';
                this.oscillator2.type = 'sawtooth';
                this.oscillator1.frequency.value = 800;
                this.oscillator2.frequency.value = 900;
                this.gainNode.gain.value = this.volume;
                
                return true;
            }
            
            start() {
                if (this.isPlaying) {
                    console.log('Siren already playing');
                    return;
                }
                
                console.log(' FIRETRUCK ALARM STARTED');
                
                const mp3Alarm = document.getElementById('fireAlarmSound');
                if (mp3Alarm) {
                    mp3Alarm.volume = this.volume;
                    mp3Alarm.loop = true;
                    
                    const playPromise = mp3Alarm.play();
                    if (playPromise !== undefined) {
                        playPromise.then(() => {
                            console.log('MP3 fire alarm playing');
                            this.isPlaying = true;
                        }).catch(error => {
                            console.log('MP3 alarm failed, using generated alarm:', error);
                            this.startGeneratedAlarm();
                        });
                    }
                } else {
                    this.startGeneratedAlarm();
                }
            }
            
            startGeneratedAlarm() {
                if (!this.createSirenSound()) {
                    console.error('Failed to create alarm sound');
                    return;
                }
                
                this.oscillator1.start();
                this.oscillator2.start();
                this.isPlaying = true;
                
                let direction = 1;
                let frequency1 = 800;
                let frequency2 = 900;
                
                this.sirenInterval = setInterval(() => {
                    frequency1 += direction * 50;
                    frequency2 += direction * 50;
                    
                    if (frequency1 >= 1200 || frequency1 <= 600) {
                        direction *= -1;
                    }
                    
                    if (this.oscillator1 && this.oscillator2) {
                        this.oscillator1.frequency.setValueAtTime(frequency1, this.audioContext.currentTime);
                        this.oscillator2.frequency.setValueAtTime(frequency2, this.audioContext.currentTime);
                    }
                    
                    if (Math.random() > 0.7) {
                        const randomMod = Math.random() * 100;
                        this.oscillator1.frequency.setValueAtTime(frequency1 + randomMod, this.audioContext.currentTime + 0.1);
                        this.oscillator2.frequency.setValueAtTime(frequency2 + randomMod, this.audioContext.currentTime + 0.1);
                    }
                    
                }, 200);
                
                console.log('Generated fire alarm playing');
            }
            
            stop() {
                console.log(' FIRETRUCK ALARM STOPPED');
                
                const mp3Alarm = document.getElementById('fireAlarmSound');
                if (mp3Alarm) {
                    mp3Alarm.pause();
                    mp3Alarm.currentTime = 0;
                }
                
                if (this.sirenInterval) {
                    clearInterval(this.sirenInterval);
                    this.sirenInterval = null;
                }
                
                if (this.oscillator1) {
                    this.oscillator1.stop();
                    this.oscillator1.disconnect();
                    this.oscillator1 = null;
                }
                
                if (this.oscillator2) {
                    this.oscillator2.stop();
                    this.oscillator2.disconnect();
                    this.oscillator2 = null;
                }
                
                if (this.gainNode) {
                    this.gainNode.disconnect();
                    this.gainNode = null;
                }
                
                this.isPlaying = false;
                
                if (this.audioContext && this.audioContext.state !== 'closed') {
                    this.audioContext.close();
                    this.audioContext = null;
                }
            }
        }
        
        // Initialize alarm system
        window.fireTruckSiren = new FireTruckSiren();

        // === MAIN APULA APP ===
        class APULAApp {
            constructor() {
                this.camera = { 
                    stream: null, 
                    mediaRecorder: null, 
                    isActive: false,
                    currentType: 'webcam'
                };
                this.isRecording = false;
                this.recordedChunks = [];
                this.waterActive = false;
                this.mediaGallery = [];
                this.currentGalleryTab = 'all';
                this.systemUptime = 0;
                this.stats = {
                    activeCameras: 0,
                    fires: 0,
                    waterActivations: 0,
                    mediaCount: 0,
                    storageUsed: 0
                };
                
                this.currentMedia = null;
                this.currentVideo = null;
                this.lastFireAlertTime = 0;
                this.fireAlertCooldown = 0; // NO COOLDOWN
                this.alertActive = false;
                this.alarmPlaying = false;
                this.autoAlertTimeout = null;
                this.alarmSilencedUntil = 0;
                this.alertSuppressedUntil = 0;
                
                this.init();
            }
            
            init() {
                console.log('APULA Fire Command Dashboard Initialized');
                console.log(' Fire detection: NO COOLDOWN');
                console.log(' Cameras: RTSP, Wi-Fi, Bluetooth, Webcam - ALL WORKING');
                
                this.loadGalleryFromStorage();
                this.bindEvents();
                this.startUptimeCounter();
                this.startDateTimeUpdater();
                this.updateGallery();
                this.showNotification('SYSTEM ONLINE', 'All camera modes available', 'safe');
                this.addLog('Emergency dashboard system initialized - NO FIRE COOLDOWN', 'info');
                
                // Initialize with webcam instructions
                selectCamera('webcam');
            }
            
            bindEvents() {
                // Bind camera tile click
                document.getElementById('cameraTile').addEventListener('click', () => {
                    selectCamera('webcam');
                });
                
                // Bind water tile click
                document.getElementById('waterStatusTile').addEventListener('click', () => {
                    if (this.waterActive) {
                        this.deactivateWater();
                    } else {
                        this.activateWater();
                    }
                });
            }
            
            // === FIRE DETECTION (NO COOLDOWN) ===
            handleFireDetection(sensorName = 'Flame Sensor') {
                // NO COOLDOWN - Always trigger fire detection
                const now = Date.now();
                
                // Update fire statistics
                this.stats.fires++;
                this.updateStats();
                
                // Update fire status tile immediately
                const fireTile = document.getElementById('fireStatusTile');
                const fireText = document.getElementById('fireStatusText');
                fireTile.className = 'status-tile critical';
                fireText.textContent = 'FIRE DETECTED';
                
                // Show emergency alert with specific sensor info
                this.showEmergencyAlert(sensorName);
                
                // PLAY LOUD FIRETRUCK ALARM IMMEDIATELY
                console.log(' FIRE DETECTED - ACTIVATING ALARM');
                this.playAlarmSound();
                
                // Also start the FireTruckSiren (fallback)
                if (window.fireTruckSiren) {
                    try {
                        window.fireTruckSiren.start();
                    } catch (error) {
                        console.error('FireTruckSiren failed:', error);
                    }
                }
                
                this.showNotification('FIRE EMERGENCY', `${sensorName} detected fire!`, 'critical');
                this.addLog(` FIRE DETECTED on ${sensorName} (NO COOLDOWN)`, 'alert');
                
                // Auto-activate water after 2 seconds
                setTimeout(() => {
                    this.activateWater();
                }, 2000);
                
                this.lastFireAlertTime = now;
            }
            
            showEmergencyAlert(sensorName) {
                // Suppress alert display during acknowledge silence window
                if (Date.now() < this.alertSuppressedUntil) {
                    return;
                }
                
                const alertModal = document.getElementById('emergencyAlert');
                const alertTime = document.getElementById('alertTime');
                const alertLocation = document.getElementById('alertLocation');
                
                const now = new Date();
                alertTime.textContent = now.toLocaleTimeString('en-US', {
                    hour12: true,
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit'
                });
                
                alertLocation.textContent = `Arduino: ${sensorName}`;
                
                alertModal.style.display = 'flex';
                this.alertActive = true;
                
                // PLAY ALARM IMMEDIATELY WHEN ALERT APPEARS
                this.playAlarmSound();
                
                // Auto-close after 30 seconds if not acknowledged
                this.autoAlertTimeout = setTimeout(() => {
                    if (alertModal.style.display === 'flex') {
                        this.acknowledgeAlert();
                    }
                }, 30000);
            }
            
            acknowledgeAlert() {
                const alertModal = document.getElementById('emergencyAlert');
                alertModal.style.display = 'none';
                this.alertActive = false;
                
                console.log(' ACKNOWLEDGE ALERT - STOPPING ALL ALARMS');
                
                // STOP ALL ALARMS WHEN ACKNOWLEDGE BUTTON IS PRESSED
                this.stopAlarmSound();
                
                // Also reset fire status
                const fireTile = document.getElementById('fireStatusTile');
                const fireText = document.getElementById('fireStatusText');
                fireTile.className = 'status-tile safe';
                fireText.textContent = 'NO FIRE';
                
                // Silence re-triggers and modal for 60 seconds
                const silenceMs = 60000;
                const now = Date.now();
                this.alarmSilencedUntil = now + silenceMs;
                this.alertSuppressedUntil = now + silenceMs;
                
                this.showNotification('ALERT ACKNOWLEDGED', 'Fire alert cleared and alarm stopped', 'safe');
                this.addLog('Alert acknowledged - all alarms stopped', 'info');
                
                if (this.autoAlertTimeout) {
                    clearTimeout(this.autoAlertTimeout);
                }
            }
            
            playAlarmSound() {
                if (Date.now() < this.alarmSilencedUntil) {
                    return;
                }
                const alarmSound = document.getElementById('fireAlarmSound');
                if (!alarmSound) {
                    return;
                }
                try {
                    this.alarmPlaying = true;
                    alarmSound.currentTime = 0;
                    alarmSound.volume = 1.0;
                    alarmSound.loop = true;
                    const playPromise = alarmSound.play();
                    if (playPromise && typeof playPromise.then === 'function') {
                        playPromise.catch(() => {});
                    }
                } catch (_) {}
            }
            
            stopAlarmSound() {
                console.log(' STOPPING FIRETRUCK ALARM');
                this.alarmPlaying = false;
                
                // Stop the FireTruckSiren
                if (window.fireTruckSiren) {
                    window.fireTruckSiren.stop();
                }
                
                // Stop MP3 alarm if playing
                const alarmSound = document.getElementById('fireAlarmSound');
                alarmSound.pause();
                alarmSound.currentTime = 0;
                
                // Reset fire status tile
                const fireTile = document.getElementById('fireStatusTile');
                const fireText = document.getElementById('fireStatusText');
                fireTile.className = 'status-tile safe';
                fireText.textContent = 'NO FIRE';
            }
            
            // === TEST FIRE ALERT FUNCTION ===
            triggerTestFireAlert() {
                console.log(' TEST FIRE ALERT TRIGGERED (NO COOLDOWN)');
                
                // Update fire statistics
                this.stats.fires++;
                this.updateStats();
                
                // Update fire status tile
                const fireTile = document.getElementById('fireStatusTile');
                const fireText = document.getElementById('fireStatusText');
                fireTile.className = 'status-tile critical';
                fireText.textContent = 'TEST FIRE';
                
                // Show test emergency alert
                const alertModal = document.getElementById('emergencyAlert');
                const alertTime = document.getElementById('alertTime');
                const alertLocation = document.getElementById('alertLocation');
                const alertSeverity = document.getElementById('alertSeverity');
                
                const now = new Date();
                alertTime.textContent = now.toLocaleTimeString('en-US', {
                    hour12: true,
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit'
                });
                
                alertLocation.textContent = 'Test Fire Alert';
                alertSeverity.textContent = 'TEST ALERT';
                alertSeverity.style.color = 'var(--hazard-yellow)';
                
                alertModal.style.display = 'flex';
                this.alertActive = true;
                
                // PLAY ALARM IMMEDIATELY WHEN TEST ALERT APPEARS
                this.playAlarmSound();
                
                this.showNotification('TEST FIRE ALERT', 'Manual test fire alert triggered', 'warning');
                this.addLog('TEST FIRE ALERT: Manual test alert triggered (NO COOLDOWN)', 'alert');
                
                // Auto-activate water after 2 seconds
                setTimeout(() => {
                    this.activateWater();
                }, 2000);
                
                // Auto-close after 30 seconds if not acknowledged
                this.autoAlertTimeout = setTimeout(() => {
                    if (alertModal.style.display === 'flex') {
                        this.acknowledgeAlert();
                    }
                }, 30000);
            }
            
            // === CAMERA FUNCTIONS ===
            startRecording() {
                if (!cameraStreamActive) {
                    this.showNotification('RECORDING ERROR', 'No camera connected', 'warning');
                    return;
                }
                
                if (this.isRecording) {
                    this.showNotification('RECORDING ERROR', 'Already recording', 'warning');
                    return;
                }
                
                this.isRecording = true;
                this.recordedChunks = [];
                
                // Update UI
                document.getElementById('recordBtn').classList.add('disabled');
                document.getElementById('stopBtn').classList.remove('disabled');
                document.getElementById('recordBtn').classList.add('recording');
                document.getElementById('recordingIndicator').style.display = 'flex';
                
                this.showNotification('RECORDING STARTED', 'Recording started', 'safe');
                this.addLog('Recording started', 'media');
                
                this.stats.storageUsed += 0.1;
                this.updateStats();
                
                // Simulate recording for 10 seconds
                setTimeout(() => {
                    if (this.isRecording) {
                        this.stopRecording();
                    }
                }, 10000);
            }
            
            stopRecording() {
                if (!this.isRecording) {
                    return;
                }
                
                this.isRecording = false;
                
                // Update UI
                document.getElementById('recordBtn').classList.remove('disabled');
                document.getElementById('stopBtn').classList.add('disabled');
                document.getElementById('recordBtn').classList.remove('recording');
                document.getElementById('recordingIndicator').style.display = 'none';
                
                this.showNotification('RECORDING STOPPED', 'Recording saved to gallery', 'info');
                this.addLog('Recording stopped', 'media');
                
                // Add to gallery
                const timestamp = new Date().toISOString();
                const mediaItem = {
                    id: Date.now(),
                    type: 'video',
                    url: '#',
                    timestamp: timestamp,
                    size: 2.5,
                    duration: 10,
                    title: `Recording_${new Date(timestamp).toLocaleString().replace(/[/:]/g, '-')}`,
                    format: 'webm'
                };
                
                this.mediaGallery.push(mediaItem);
                this.stats.mediaCount++;
                this.updateGallery();
                this.saveGalleryToStorage();
            }
            
            captureSnapshot() {
                if (!cameraStreamActive) {
                    this.showNotification('SNAPSHOT ERROR', 'Camera is not connected', 'warning');
                    return;
                }
                
                const timestamp = new Date().toISOString();
                const mediaItem = {
                    id: Date.now(),
                    type: 'photo',
                    url: '#',
                    timestamp: timestamp,
                    size: 0.5,
                    title: `Snapshot_${new Date(timestamp).toLocaleString().replace(/[/:]/g, '-')}`,
                    format: 'jpeg'
                };
                
                this.mediaGallery.push(mediaItem);
                this.stats.mediaCount++;
                this.stats.storageUsed += 0.5;
                this.updateStats();
                this.updateGallery();
                this.saveGalleryToStorage();
                
                this.showNotification('SNAPSHOT CAPTURED', 'Photo saved to gallery', 'media');
                this.addLog('Snapshot captured and saved', 'media');
                
                // Visual feedback
                this.flashCameraFeedback();
            }
            
            flashCameraFeedback() {
                const flash = document.createElement('div');
                flash.style.position = 'absolute';
                flash.style.top = '0';
                flash.style.left = '0';
                flash.style.width = '100%';
                flash.style.height = '100%';
                flash.style.background = 'rgba(255, 255, 255, 0.8)';
                flash.style.pointerEvents = 'none';
                flash.style.zIndex = '100';
                flash.style.animation = 'fadeOut 0.3s ease forwards';
                
                const cameraFeed = document.querySelector('.camera-feed');
                cameraFeed.appendChild(flash);
                
                setTimeout(() => {
                    if (flash.parentNode) {
                        flash.remove();
                    }
                }, 300);
            }
            
            activateWater() {
                if (this.waterActive) {
                    this.showNotification('WATER SYSTEM', 'Already active', 'warning');
                    return;
                }
                
                this.waterActive = true;
                this.stats.waterActivations++;
                
                const waterTile = document.getElementById('waterStatusTile');
                const waterText = document.getElementById('waterStatusText');
                waterTile.className = 'status-tile safe';
                waterText.textContent = 'WATER ACTIVE';
                
                document.getElementById('metricWater').textContent = this.stats.waterActivations;
                document.getElementById('activateWaterBtn').classList.add('disabled');
                
                this.showNotification('WATER SYSTEM ACTIVATED', 'Water system activated', 'safe');
                this.addLog('Water system activated', 'water');
                this.updateStats();
                
                // Visual water effect
                const waterEffect = document.createElement('div');
                waterEffect.style.position = 'fixed';
                waterEffect.style.top = '0';
                waterEffect.style.left = '0';
                waterEffect.style.width = '100%';
                waterEffect.style.height = '100%';
                waterEffect.style.background = 'radial-gradient(circle, rgba(0,168,255,0.1) 0%, transparent 70%)';
                waterEffect.style.pointerEvents = 'none';
                waterEffect.style.zIndex = '9999';
                waterEffect.style.animation = 'fadeOut 2s forwards';
                document.body.appendChild(waterEffect);
                
                // Auto-stop water after 10 seconds
                setTimeout(() => {
                    this.deactivateWater();
                }, 10000);
            }
            
            deactivateWater() {
                if (!this.waterActive) return;
                
                this.waterActive = false;
                
                const waterTile = document.getElementById('waterStatusTile');
                const waterText = document.getElementById('waterStatusText');
                waterTile.className = 'status-tile';
                waterText.textContent = 'WATER READY';
                
                document.getElementById('activateWaterBtn').classList.remove('disabled');
                
                this.showNotification('WATER SYSTEM', 'Deactivated', 'info');
                this.addLog('Water system deactivated', 'water');
            }
            
            // === DATE/TIME UPDATER ===
            startDateTimeUpdater() {
                this.updateDateTime();
                setInterval(() => {
                    this.updateDateTime();
                }, 1000);
            }
            
            updateDateTime() {
                const now = new Date();
                
                const timeString = now.toLocaleTimeString('en-US', {
                    hour12: true,
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit'
                });
                
                const dateString = now.toLocaleDateString('en-US', {
                    month: '2-digit',
                    day: '2-digit',
                    year: 'numeric'
                });
                
                const dateTimeElement = document.getElementById('currentDateTime');
                if (dateTimeElement) {
                    dateTimeElement.textContent = `${timeString} ${dateString}`;
                }
                
                if (this.alertActive) {
                    const alertTimeElement = document.getElementById('alertTime');
                    if (alertTimeElement) {
                        alertTimeElement.textContent = timeString;
                    }
                }
            }
            
            // === GALLERY FUNCTIONS ===
            showGalleryTab(tab) {
                this.currentGalleryTab = tab;
                
                const tabs = document.querySelectorAll('.gallery-tab');
                tabs.forEach(t => t.classList.remove('active'));
                event.target.classList.add('active');
                
                this.updateGallery();
            }
            
            updateGallery() {
                const galleryGrid = document.getElementById('galleryGrid');
                const emptyGallery = document.getElementById('emptyGallery');
                
                galleryGrid.innerHTML = '';
                
                let filteredMedia = this.mediaGallery;
                if (this.currentGalleryTab === 'photos') {
                    filteredMedia = this.mediaGallery.filter(item => item.type === 'photo');
                } else if (this.currentGalleryTab === 'videos') {
                    filteredMedia = this.mediaGallery.filter(item => item.type === 'video');
                }
                
                if (filteredMedia.length === 0) {
                    emptyGallery.style.display = 'flex';
                    return;
                }
                
                emptyGallery.style.display = 'none';
                
                filteredMedia.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                
                filteredMedia.forEach((item, index) => {
                    const galleryItem = document.createElement('div');
                    galleryItem.className = 'gallery-item';
                    galleryItem.dataset.id = item.id;
                    
                    const date = new Date(item.timestamp);
                    const timeString = date.toLocaleTimeString('en-US', {
                        hour12: true,
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                    const dateString = date.toLocaleDateString();
                    
                    if (item.type === 'photo') {
                        galleryItem.innerHTML = `
                            <div style="width:100%;height:100%;background:linear-gradient(135deg,#1a1a25,#2a1a25);display:flex;align-items:center;justify-content:center;">
                                <i class="fas fa-camera" style="font-size:2rem;color:var(--fire-orange);"></i>
                            </div>
                            <div class="gallery-item-info">
                                <span>${timeString} | ${dateString}</span>
                                <div class="gallery-item-actions">
                                    <button class="gallery-item-btn" onclick="app.viewMedia(${item.id})" title="View">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="gallery-item-btn" onclick="app.downloadMedia(${item.id})" title="Download">
                                        <i class="fas fa-download"></i>
                                    </button>
                                    <button class="gallery-item-btn" onclick="app.deleteMedia(${item.id})" title="Delete">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="gallery-item-type">PHOTO</div>
                        `;
                    } else if (item.type === 'video') {
                        galleryItem.innerHTML = `
                            <div style="width:100%;height:100%;background:linear-gradient(135deg,#1a1a25,#2a1a25);display:flex;align-items:center;justify-content:center;">
                                <i class="fas fa-video" style="font-size:2rem;color:var(--water-blue);"></i>
                            </div>
                            <div class="gallery-item-info">
                                <span>${timeString} | ${dateString} | ${item.duration}s</span>
                                <div class="gallery-item-actions">
                                    <button class="gallery-item-btn" onclick="app.viewMedia(${item.id})" title="View">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="gallery-item-btn" onclick="app.downloadMedia(${item.id})" title="Download">
                                        <i class="fas fa-download"></i>
                                    </button>
                                    <button class="gallery-item-btn" onclick="app.deleteMedia(${item.id})" title="Delete">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="gallery-item-type">VIDEO</div>
                        `;
                    }
                    
                    galleryGrid.appendChild(galleryItem);
                });
                
                document.getElementById('metricMedia').textContent = this.mediaGallery.length;
            }
            
            viewMedia(id) {
                const mediaItem = this.mediaGallery.find(item => item.id === id);
                if (!mediaItem) return;
                
                this.currentMedia = mediaItem;
                const viewer = document.getElementById('mediaViewer');
                const content = document.getElementById('mediaContent');
                const info = document.getElementById('mediaInfo');
                const videoControls = document.getElementById('videoControls');
                
                const date = new Date(mediaItem.timestamp);
                const timeString = date.toLocaleTimeString('en-US', {
                    hour12: true,
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit'
                });
                const dateString = date.toLocaleDateString();
                
                if (mediaItem.type === 'photo') {
                    content.innerHTML = `
                        <div style="width:100%;height:400px;background:linear-gradient(135deg,#1a1a25,#2a1a25);display:flex;align-items:center;justify-content:center;flex-direction:column;">
                            <i class="fas fa-camera" style="font-size:4rem;color:var(--fire-orange);margin-bottom:20px;"></i>
                            <h3 style="color:var(--aluminum);">${mediaItem.title}</h3>
                        </div>
                    `;
                    videoControls.style.display = 'none';
                    info.innerHTML = `
                        <div>
                            <strong>Photo</strong> | ${dateString} ${timeString} | ${mediaItem.size.toFixed(2)} MB
                        </div>
                        <div>
                            <button class="gallery-item-btn" onclick="app.downloadMedia(${mediaItem.id})">
                                <i class="fas fa-download"></i> Download
                            </button>
                        </div>
                    `;
                } else if (mediaItem.type === 'video') {
                    content.innerHTML = `
                        <div style="width:100%;height:400px;background:linear-gradient(135deg,#1a1a25,#2a1a25);display:flex;align-items:center;justify-content:center;flex-direction:column;">
                            <i class="fas fa-video" style="font-size:4rem;color:var(--water-blue);margin-bottom:20px;"></i>
                            <h3 style="color:var(--aluminum);">${mediaItem.title}</h3>
                            <p style="color:var(--aluminum);margin-top:10px;">Duration: ${mediaItem.duration} seconds</p>
                        </div>
                    `;
                    videoControls.style.display = 'flex';
                    info.innerHTML = `
                        <div>
                            <strong>Video</strong> | ${dateString} ${timeString} | ${mediaItem.duration}s | ${mediaItem.size.toFixed(2)} MB
                        </div>
                        <div>
                            <button class="gallery-item-btn" onclick="app.downloadMedia(${mediaItem.id})">
                                <i class="fas fa-download"></i> Download
                            </button>
                        </div>
                    `;
                }
                
                viewer.style.display = 'flex';
            }
            
            closeMediaViewer() {
                const viewer = document.getElementById('mediaViewer');
                viewer.style.display = 'none';
                this.currentMedia = null;
            }
            
            toggleVideoPlayback() {
                // Simulated function
                this.showNotification('VIDEO PLAYBACK', 'Video playback control', 'info');
            }
            
            toggleVideoMute() {
                // Simulated function
                this.showNotification('VIDEO MUTE', 'Audio mute control', 'info');
            }
            
            downloadMedia(id) {
                const mediaItem = this.mediaGallery.find(item => item.id === id);
                if (!mediaItem) return;
                
                this.showNotification('DOWNLOAD STARTED', `Downloading ${mediaItem.type}`, 'info');
                this.addLog(`Downloaded ${mediaItem.type}: ${mediaItem.title}`, 'media');
                
                // Simulate download
                setTimeout(() => {
                    this.showNotification('DOWNLOAD COMPLETE', `${mediaItem.type} downloaded successfully`, 'safe');
                }, 1000);
            }
            
            downloadCurrentMedia() {
                if (this.currentMedia) {
                    this.downloadMedia(this.currentMedia.id);
                }
            }
            
            deleteMedia(id) {
                if (!confirm('Are you sure you want to delete this media file?')) {
                    return;
                }
                
                const index = this.mediaGallery.findIndex(item => item.id === id);
                if (index === -1) return;
                
                const mediaItem = this.mediaGallery[index];
                this.mediaGallery.splice(index, 1);
                
                this.updateGallery();
                this.saveGalleryToStorage();
                
                this.showNotification('MEDIA DELETED', 'Media file removed from gallery', 'info');
                this.addLog(`Deleted ${mediaItem.type}: ${mediaItem.title}`, 'media');
            }
            
            clearGallery() {
                if (this.mediaGallery.length === 0) {
                    this.showNotification('GALLERY', 'Gallery is already empty', 'info');
                    return;
                }
                
                if (!confirm('Are you sure you want to clear all media from the gallery? This cannot be undone.')) {
                    return;
                }
                
                this.mediaGallery = [];
                this.stats.mediaCount = 0;
                this.stats.storageUsed = 0;
                
                this.updateGallery();
                this.updateStats();
                this.saveGalleryToStorage();
                
                this.showNotification('GALLERY CLEARED', 'All media files removed', 'info');
                this.addLog('Gallery cleared - all media files removed', 'media');
            }
            
            loadGalleryFromStorage() {
                const savedGallery = localStorage.getItem('apula_gallery');
                if (savedGallery) {
                    try {
                        this.mediaGallery = JSON.parse(savedGallery);
                        this.addLog('Gallery loaded from local storage', 'info');
                    } catch (e) {
                        console.error('Failed to load gallery:', e);
                        this.mediaGallery = [];
                    }
                }
            }
            
            saveGalleryToStorage() {
                try {
                    localStorage.setItem('apula_gallery', JSON.stringify(this.mediaGallery));
                } catch (e) {
                    console.error('Failed to save gallery:', e);
                }
            }
            
            updateCameraStatus() {
                const cameraTile = document.getElementById('cameraTile');
                const cameraTileText = document.getElementById('cameraTileText');
                const cameraStatus = document.getElementById('cameraStatusText');
                const cameraDot = document.getElementById('cameraStatusDot');
                
                if (cameraStreamActive) {
                    cameraTile.className = 'status-tile safe';
                    cameraTileText.textContent = 'CAMERA ONLINE';
                    cameraStatus.textContent = 'CAMERA: ACTIVE';
                    cameraDot.className = 'status-dot safe';
                } else {
                    cameraTile.className = 'status-tile warning';
                    cameraTileText.textContent = 'CAMERA OFFLINE';
                    cameraStatus.textContent = 'CAMERA: READY';
                    cameraDot.className = 'status-dot warning';
                }
            }
            
            updateStats() {
                document.getElementById('metricCameras').textContent = `${cameraStreamActive ? 1 : 0}/1`;
                document.getElementById('metricFires').textContent = this.stats.fires;
                document.getElementById('metricWater').textContent = this.stats.waterActivations;
                document.getElementById('metricMedia').textContent = this.stats.mediaCount;
            }
            
            startUptimeCounter() {
                setInterval(() => {
                    this.systemUptime++;
                    const hours = Math.floor(this.systemUptime / 3600);
                    const minutes = Math.floor((this.systemUptime % 3600) / 60);
                    const seconds = this.systemUptime % 60;
                    
                    // You can add uptime display if needed
                }, 1000);
            }
            
            showNotification(title, message, type = 'info') {
                const notificationCenter = document.getElementById('notificationCenter');
                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                
                notification.innerHTML = `
                    <div class="notification-title">
                        <i class="fas fa-${type === 'critical' ? 'fire' : type === 'warning' ? 'exclamation-triangle' : type === 'media' ? 'camera' : 'info-circle'}"></i>
                        ${title}
                    </div>
                    <div class="notification-message">${message}</div>
                `;
                
                notificationCenter.appendChild(notification);
                
                setTimeout(() => {
                    notification.style.opacity = '0';
                    notification.style.transform = 'translateX(100%)';
                    setTimeout(() => notification.remove(), 300);
                }, 5000);
            }
            
            addLog(message, type = 'info') {
                const logContainer = document.getElementById('logContainer');
                const logEntry = document.createElement('div');
                logEntry.className = `log-entry ${type}`;
                
                const time = new Date();
                const timeStr = time.toLocaleTimeString('en-US', { 
                    hour12: true,
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit'
                });
                
                logEntry.innerHTML = `
                    <span class="log-time">${timeStr}</span>
                    <span class="log-message">${message}</span>
                `;
                
                logContainer.appendChild(logEntry);
                logContainer.scrollTop = logContainer.scrollHeight;
                
                while (logContainer.children.length > 50) {
                    logContainer.removeChild(logContainer.firstChild);
                }
            }
            
            clearLogs() {
                if (confirm('Clear all system logs?')) {
                    const logContainer = document.getElementById('logContainer');
                    logContainer.innerHTML = '';
                    this.addLog('Logs cleared', 'info');
                }
            }
            
            showLoading(show) {
                const overlay = document.getElementById('loadingOverlay');
                overlay.style.display = show ? 'flex' : 'none';
            }
        }

        // Initialize the main app
        window.app = new APULAApp();

        // Add fadeOut animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes fadeOut {
                from { opacity: 1; }
                to { opacity: 0; }
            }
        `;
        document.head.appendChild(style);

        // Initialize WebSocket connection for Arduino
        function connectWebSocket() {
            const ws = new WebSocket(`ws://${window.location.host}/arduino-ws`);
            
            ws.onopen = () => {
                console.log(' WebSocket connected to server');
                app.addLog('WebSocket connected to Arduino server', 'info');
            };
            
            ws.onmessage = (event) => {
                try {
                    const data = JSON.parse(event.data);
                    
                    switch(data.type) {
                        case 'arduino_status':
                            updateArduinoStatus(data);
                            break;
                        case 'sensor_update':
                            updateSensorDisplay(data);
                            break;
                        case 'fire_alert':
                            handleFireAlert(data);
                            break;
                        case 'log_entry':
                            app.addLog(data.log.message, data.log.type);
                            break;
                    }
                } catch (error) {
                    console.error('Error parsing WebSocket message:', error);
                }
            };
            
            ws.onerror = (error) => {
                console.error('WebSocket error:', error);
                app.addLog('WebSocket connection error', 'warning');
            };
            
            ws.onclose = () => {
                console.log('WebSocket disconnected, reconnecting...');
                setTimeout(connectWebSocket, 3000);
            };
        }
        
        function updateArduinoStatus(data) {
            const arduinoTile = document.getElementById('arduinoTile');
            const arduinoTileText = document.getElementById('arduinoTileText');
            const arduinoStatusText = document.getElementById('arduinoStatusText');
            const arduinoStatusDot = document.getElementById('arduinoStatusDot');
            const sensorDisplay = document.getElementById('sensorDisplay');
            
            if (data.status === 'connected') {
                arduinoTile.className = 'status-tile safe';
                arduinoTileText.textContent = 'ARDUINO ONLINE';
                arduinoStatusText.textContent = 'ARDUINO: CONNECTED';
                arduinoStatusDot.className = 'status-dot safe';
                sensorDisplay.style.display = 'grid';
                app.addLog('Arduino connected via WebSocket', 'arduino');
            } else {
                arduinoTile.className = 'status-tile warning';
                arduinoTileText.textContent = 'ARDUINO OFFLINE';
                arduinoStatusText.textContent = 'ARDUINO: OFFLINE';
                arduinoStatusDot.className = 'status-dot warning';
                sensorDisplay.style.display = 'none';
                app.addLog('Arduino disconnected', 'warning');
            }
        }
        
        function updateSensorDisplay(data) {
            // Update sensor values
            if (data.sensorValues) {
                for (let i = 0; i < 3; i++) {
                    const element = document.getElementById(`sensor${i + 1}Value`);
                    if (element) {
                        const value = data.sensorValues[i];
                        if (value === 0) {
                            element.textContent = ' FIRE';
                            element.className = 'sensor-value critical';
                        } else {
                            element.textContent = ' OK';
                            element.className = 'sensor-value safe';
                        }
                    }
                }
                
                // Update fire status tile
                const fireDetected = data.sensorValues.includes(0);
                const fireTile = document.getElementById('fireStatusTile');
                const fireText = document.getElementById('fireStatusText');
                
                if (fireDetected) {
                    fireTile.className = 'status-tile critical';
                    fireText.textContent = `FIRE x${data.sensorValues.filter(v => v === 0).length}`;
                } else {
                    fireTile.className = 'status-tile safe';
                    fireText.textContent = 'NO FIRE';
                }
            }
        }
        
        function handleFireAlert(data) {
            if (data.fireDetected) {
                app.handleFireDetection(data.location || 'Unknown Sensor');
                
                // Show Arduino alert
                const alertElement = document.getElementById('arduinoFireAlert');
                const locationElement = document.getElementById('arduinoAlertLocation');
                
                if (alertElement && locationElement) {
                    locationElement.textContent = `${data.location} - FIRE DETECTED`;
                    alertElement.style.display = 'block';
                    
                    setTimeout(() => {
                        if (alertElement.style.display === 'block') {
                            alertElement.style.display = 'none';
                        }
                    }, 10000);
                }
            }
        }
        
        // Connect WebSocket on page load
        window.addEventListener('load', () => {
            setTimeout(connectWebSocket, 1000);
        });
    </script>
</body>
</html>
